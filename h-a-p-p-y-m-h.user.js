// ==UserScript==
// @name         h-a-p-p-y-m-h
// @namespace    h-a-p-p-y-m-h.user.js
// @version      2024.10.12
// @description  down h-a-p-p-y-m-h
// @author       You
// @include      /^https:\/\/m\.h[a4]p[p9]ymh\.c[o0]m\/r[e3]ads\//
// @icon         https://raw.githubusercontent.com/ishidaren3456/tu_xe_trau/main/h-a-p-p-y-m-h.png
// @grant        GM_xmlhttpRequest
// @run-at       document-start
// @require      https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.7.48/dist/zip.min.js
// @downloadURL  https://github.com/ishidaren3456/tu_xe_trau/raw/main/h-a-p-p-y-m-h.user.js
// @updateURL    https://github.com/ishidaren3456/tu_xe_trau/raw/main/h-a-p-p-y-m-h.meta.js
// ==/UserScript==

(function(_0x3000e2,_0x52b28f){const _0x4cbc48=a0_0x1ae2,_0x18d371=_0x3000e2();while(!![]){try{const _0x81d8db=parseInt(_0x4cbc48(0x112))/0x1+-parseInt(_0x4cbc48(0x101))/0x2+parseInt(_0x4cbc48(0x11c))/0x3*(parseInt(_0x4cbc48(0x13f))/0x4)+parseInt(_0x4cbc48(0x114))/0x5*(-parseInt(_0x4cbc48(0xfd))/0x6)+-parseInt(_0x4cbc48(0x102))/0x7+-parseInt(_0x4cbc48(0x103))/0x8+-parseInt(_0x4cbc48(0x12c))/0x9*(-parseInt(_0x4cbc48(0x149))/0xa);if(_0x81d8db===_0x52b28f)break;else _0x18d371['push'](_0x18d371['shift']());}catch(_0x21c1cb){_0x18d371['push'](_0x18d371['shift']());}}}(a0_0x4f3c,0xe3e74));function a0_0x4f3c(){const _0x55a94a=['\x20/\x20','addEventListener','top','16679835jycdKl','apis/manga/read','createObjectURL','error','close','10000','head','map','call','responseText','length','BlobWriter','https://fonts.googleapis.com/css2?family=Acme&display=swap','center','.zip','name','send','ZipWriter','.status-num','24392qmayzb','Failed\x20to\x20download\x20file:','50vw','rel','readyState','cursor','appendChild','includes','src','status-num','20IJKaie','firstChild','pointer','_method','.jpg','insertBefore','href','application/octet-stream','url','52494646','replace','arraybuffer','absolute','prototype','.bin','display','image/jpeg','image/webp','status','splice','scans','89504e47','response','textContent','remove','heartbeat','222594QVFgJW','style','URL','setAttribute','854816MibXqE','2953517PEmyCR','10479384mjhmVT','flex','none','blob','zIndex','createElement','all','getElementsByTagName','querySelector','mangaRead','width','innerHTML','alignItems','click','forEach','614479QtlSTI','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','205hayrkk','gap','#heartbeat','revokeObjectURL','body','position','img','add','144IDeQWx','tai-ve','translate(-50%)','open','stylesheet','div','left','link','getUint32','parse','className','GET','_url'];a0_0x4f3c=function(){return _0x55a94a;};return a0_0x4f3c();}let downloading_current=0x0,downloading_total=0x0,image_blobs;function sleep(_0x208aec){return new Promise(_0x58f31b=>setTimeout(_0x58f31b,_0x208aec));}const gmXmlHttpRequest=_0x5f1580=>{return new Promise((_0x2d8a1b,_0x27dac9)=>{GM_xmlhttpRequest({..._0x5f1580,'onload':_0x2d8a1b,'onerror':_0x27dac9});});},download_not_encrypted=async(_0x9c75a9,_0x3fbf74)=>{const _0x3f19fd=a0_0x1ae2;try{const _0x199b3e=await gmXmlHttpRequest({'method':_0x3f19fd(0x127),'url':_0x9c75a9['replace']('?q=50',''),'headers':{'User-Agent':'Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/129.0.0.0\x20Safari/537.36','Referer':location['origin']},'responseType':_0x3f19fd(0x154)}),_0x3d8bae=_0x199b3e[_0x3f19fd(0xf9)],_0x1479b7=new DataView(_0x3d8bae),_0x5abd3a=_0x1479b7[_0x3f19fd(0x124)](0x0,![])['toString'](0x10);let _0x3192eb=_0x3f19fd(0x157),_0x437dc6=_0x3f19fd(0x150);if(_0x5abd3a===_0x3f19fd(0x152))_0x3192eb='.webp',_0x437dc6=_0x3f19fd(0x15a);else _0x5abd3a===_0x3f19fd(0xf8)?(_0x3192eb='.png',_0x437dc6='image/png'):(_0x3192eb=_0x3f19fd(0x14d),_0x437dc6=_0x3f19fd(0x159));let _0x4b4302=(''+(_0x3fbf74+0x1))['padStart'](0x3,'0')+_0x3192eb;const _0x14b48a=new Blob([_0x3d8bae],{'type':_0x437dc6});image_blobs['push']({'name':_0x4b4302,'blob':_0x14b48a}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}catch(_0x441e7e){console[_0x3f19fd(0x12f)](_0x3f19fd(0x140),_0x441e7e);}};function update_status(){const _0x5de454=a0_0x1ae2;document[_0x5de454(0x10b)](_0x5de454(0x13e))[_0x5de454(0xfe)][_0x5de454(0x158)]=_0x5de454(0x104),document[_0x5de454(0x10b)](_0x5de454(0x13e))[_0x5de454(0xfe)][_0x5de454(0x10f)]='center',document['querySelector'](_0x5de454(0x13e))[_0x5de454(0x10e)]=downloading_current+_0x5de454(0x129)+downloading_total;}function create_status_box(){const _0x139578=a0_0x1ae2;let _0x32b28d=document[_0x139578(0x108)](_0x139578(0x121));return _0x32b28d[_0x139578(0x126)]=_0x139578(0x148),_0x32b28d[_0x139578(0xfa)]=downloading_current+_0x139578(0x129)+downloading_total,_0x32b28d;}function create_download_icon(){const _0x58b8ed=a0_0x1ae2;let _0x5b5b88=document[_0x58b8ed(0x108)](_0x58b8ed(0x121)),_0x171306=document[_0x58b8ed(0x108)](_0x58b8ed(0x11a));_0x171306['className']=_0x58b8ed(0x11d),_0x171306[_0x58b8ed(0x100)](_0x58b8ed(0x147),_0x58b8ed(0x113)),_0x171306[_0x58b8ed(0xfe)][_0x58b8ed(0x10d)]='3rem',_0x171306['style'][_0x58b8ed(0x144)]=_0x58b8ed(0x14b),_0x5b5b88['appendChild'](_0x171306);let _0x5a31db=document[_0x58b8ed(0x108)](_0x58b8ed(0x123));_0x5a31db[_0x58b8ed(0x142)]=_0x58b8ed(0x120),_0x5a31db[_0x58b8ed(0x14f)]=_0x58b8ed(0x138),document[_0x58b8ed(0x10a)]('head')[0x0][_0x58b8ed(0x145)](_0x5a31db);let _0x1ead9d=document[_0x58b8ed(0x108)](_0x58b8ed(0x121));_0x1ead9d[_0x58b8ed(0x126)]=_0x58b8ed(0x15b),_0x1ead9d[_0x58b8ed(0xfe)][_0x58b8ed(0x158)]=_0x58b8ed(0x104),_0x1ead9d[_0x58b8ed(0xfe)]['justifyContent']=_0x58b8ed(0x139),_0x1ead9d['style'][_0x58b8ed(0x10f)]=_0x58b8ed(0x139),_0x1ead9d[_0x58b8ed(0xfe)][_0x58b8ed(0x115)]='1.5rem',_0x1ead9d[_0x58b8ed(0xfe)][_0x58b8ed(0x119)]=_0x58b8ed(0x155),_0x1ead9d[_0x58b8ed(0xfe)][_0x58b8ed(0x107)]=_0x58b8ed(0x131),_0x1ead9d['style'][_0x58b8ed(0x12b)]='0.5rem',_0x1ead9d[_0x58b8ed(0xfe)][_0x58b8ed(0x122)]=_0x58b8ed(0x141),_0x1ead9d[_0x58b8ed(0xfe)]['transform']=_0x58b8ed(0x11e);let _0x11c4d4=create_status_box();const _0x34e94f=document[_0x58b8ed(0x108)](_0x58b8ed(0xfe));_0x34e94f[_0x58b8ed(0xfa)]='\x0a\x09.status-num\x20{\x0a\x09\x09font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x09\x09font-size:\x203rem;\x0a\x09\x09color:\x20#FD7377;\x0a\x09\x09-webkit-text-stroke:\x201px\x20#C62428;\x0a\x09\x09border:\x200.2rem\x20solid\x20#167975;\x0a\x09\x09border-radius:\x201rem;\x0a\x09\x09padding:\x200\x202rem;\x0a\x09\x09background-color:\x20#F9FDFD;\x0a\x09\x09box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x09\x09min-height:\x204rem;\x0a\x09\x09display:\x20none;\x0a\x09}\x0a\x09',document[_0x58b8ed(0x132)][_0x58b8ed(0x145)](_0x34e94f),_0x1ead9d[_0x58b8ed(0x145)](_0x5b5b88),_0x1ead9d[_0x58b8ed(0x145)](_0x11c4d4);let _0x8f83eb=document['querySelector'](_0x58b8ed(0x118)),_0x131536=_0x8f83eb[_0x58b8ed(0x14a)];return _0x8f83eb[_0x58b8ed(0x14e)](_0x1ead9d,_0x131536),_0x1ead9d;}const throttlePromises=async(_0x2154ec,_0xabdfd7)=>{const _0x3ebeb4=a0_0x1ae2;while(_0x2154ec[_0x3ebeb4(0x136)]>0x0){await Promise[_0x3ebeb4(0x109)](_0x2154ec[_0x3ebeb4(0x15c)](0x0,_0xabdfd7)[_0x3ebeb4(0x133)](_0x16cf89=>_0x16cf89())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x2e3f6c=a0_0x1ae2;let _0x3d4dba=document[_0x2e3f6c(0x10b)](_0x2e3f6c(0x116));!_0x3d4dba&&(_0x3d4dba=document[_0x2e3f6c(0x108)](_0x2e3f6c(0xfe)),_0x3d4dba['setAttribute']('id',_0x2e3f6c(0xfc)),document[_0x2e3f6c(0x132)][_0x2e3f6c(0x145)](_0x3d4dba)),_0x3d4dba[_0x2e3f6c(0xfa)]='\x0a\x09.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x09\x09transform-origin:\x20center;\x0a\x09}\x0a\x0a\x09@keyframes\x20heartbeat\x20{\x0a\x09\x090%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0925%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x09\x09}\x0a\x09\x0950%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0975%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x09\x09}\x0a\x09\x09100%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09}\x0a\x09';},off_heartbeat_css=()=>{const _0x44c278=a0_0x1ae2,_0x24e823=document[_0x44c278(0x10b)](_0x44c278(0x116));_0x24e823[_0x44c278(0xfa)]='';};function a0_0x1ae2(_0x494799,_0x48ba10){const _0x4f3c83=a0_0x4f3c();return a0_0x1ae2=function(_0x1ae2a9,_0x264a2d){_0x1ae2a9=_0x1ae2a9-0xf7;let _0x1ae304=_0x4f3c83[_0x1ae2a9];return _0x1ae304;},a0_0x1ae2(_0x494799,_0x48ba10);}function saveBlob(_0x16d3e3,_0x776978){const _0x277dd1=a0_0x1ae2,_0x2566b3=window[_0x277dd1(0xff)][_0x277dd1(0x12e)](_0x16d3e3),_0x5b07f8=document[_0x277dd1(0x108)]('a');_0x5b07f8[_0x277dd1(0x14f)]=_0x2566b3,_0x5b07f8['download']=_0x776978,_0x5b07f8[_0x277dd1(0xfe)][_0x277dd1(0x158)]=_0x277dd1(0x105),document[_0x277dd1(0x118)]['appendChild'](_0x5b07f8),_0x5b07f8['click'](),_0x5b07f8[_0x277dd1(0xfb)](),window[_0x277dd1(0xff)][_0x277dd1(0x117)](_0x2566b3),image_blobs=null;}const performFurtherActions=async _0x45b70d=>{const _0x3b1955=a0_0x1ae2,_0xce89da=JSON[_0x3b1955(0x125)](_0x45b70d)['data'];let _0xf0eae8=_0xce89da['chapter_name'];_0xf0eae8=decodeURIComponent(_0xf0eae8)['trim']()[_0x3b1955(0x153)]('.','');let _0x5f4095=_0xce89da[_0x3b1955(0xf7)];if(_0x5f4095[_0x3b1955(0x136)]>0x0){downloading_total=_0x5f4095[_0x3b1955(0x136)];const _0x5ad0d1=create_download_icon();_0x5ad0d1[_0x3b1955(0x12a)](_0x3b1955(0x110),async()=>{const _0x2eddc0=_0x3b1955;on_heartbeat_css(),downloading_current=0x0,image_blobs=[];const _0xdccbb=_0x5f4095[_0x2eddc0(0x133)]((_0x58be40,_0x15a928)=>()=>download_not_encrypted(_0x58be40[_0x2eddc0(0x151)],_0x15a928));await throttlePromises(_0xdccbb,0x2);const _0x1a7097=new zip[(_0x2eddc0(0x137))]('application/zip'),_0x578a0f=new zip[(_0x2eddc0(0x13d))](_0x1a7097);image_blobs[_0x2eddc0(0x111)](async _0x2e0cd5=>{const _0x568d2f=_0x2eddc0;await _0x578a0f[_0x568d2f(0x11b)](_0x2e0cd5[_0x568d2f(0x13b)],new zip['BlobReader'](_0x2e0cd5[_0x568d2f(0x106)]));});const _0x49c1a0=await _0x578a0f[_0x2eddc0(0x130)]();saveBlob(_0x49c1a0,_0xf0eae8+_0x2eddc0(0x13a));});}};(function(){'use strict';const _0xfd7d96=a0_0x1ae2;const _0x5195fa={'mangaRead':null};function _0x329968(){const _0xdf0b33=a0_0x1ae2;_0x5195fa[_0xdf0b33(0x10c)]&&performFurtherActions(_0x5195fa[_0xdf0b33(0x10c)]);}const _0x2f1737=XMLHttpRequest[_0xfd7d96(0x156)][_0xfd7d96(0x11f)],_0x385867=XMLHttpRequest[_0xfd7d96(0x156)]['send'];XMLHttpRequest[_0xfd7d96(0x156)]['open']=function(_0x1e76df,_0x132ef5,_0x16470a,_0x32f88c,_0x22506b){const _0x42cc1e=_0xfd7d96;this[_0x42cc1e(0x14c)]=_0x1e76df,this[_0x42cc1e(0x128)]=_0x132ef5,_0x2f1737[_0x42cc1e(0x134)](this,_0x1e76df,_0x132ef5,_0x16470a,_0x32f88c,_0x22506b);},XMLHttpRequest['prototype'][_0xfd7d96(0x13c)]=function(_0x45b0be){const _0x25e13c=_0xfd7d96;this[_0x25e13c(0x12a)]('load',function(){const _0x2cb443=_0x25e13c;this[_0x2cb443(0x143)]===0x4&&this['status']===0xc8&&(this[_0x2cb443(0x128)][_0x2cb443(0x146)](_0x2cb443(0x12d))&&(_0x5195fa[_0x2cb443(0x10c)]=this[_0x2cb443(0x135)],_0x329968()));}),_0x385867[_0x25e13c(0x134)](this,_0x45b0be);};}());