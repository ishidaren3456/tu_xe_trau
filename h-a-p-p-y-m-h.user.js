// ==UserScript==
// @name         h-a-p-p-y-m-h
// @namespace    h-a-p-p-y-m-h.user.js
// @version      2024.10.11
// @description  down h-a-p-p-y-m-h
// @author       You
// @include      /^https:\/\/m\.h[a4]p[p9]ymh\.c[o0]m\/r[e3]ads\//
// @icon         https://raw.githubusercontent.com/ishidaren3456/tu_xe_trau/main/h-a-p-p-y-m-h.png
// @grant        GM_xmlhttpRequest
// @run-at       document-start
// @require      https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.7.48/dist/zip.min.js
// @downloadURL  https://github.com/ishidaren3456/tu_xe_trau/raw/main/h-a-p-p-y-m-h.user.js
// @updateURL    https://github.com/ishidaren3456/tu_xe_trau/raw/main/h-a-p-p-y-m-h.meta.js
// ==/UserScript==

(function(_0x1ca3ec,_0x23c462){const _0x48a915=a0_0x2e79,_0x4ca1d3=_0x1ca3ec();while(!![]){try{const _0x110ab7=parseInt(_0x48a915(0x196))/0x1*(-parseInt(_0x48a915(0x18d))/0x2)+-parseInt(_0x48a915(0x178))/0x3+parseInt(_0x48a915(0x1ae))/0x4*(parseInt(_0x48a915(0x180))/0x5)+parseInt(_0x48a915(0x19e))/0x6*(parseInt(_0x48a915(0x188))/0x7)+-parseInt(_0x48a915(0x19c))/0x8*(parseInt(_0x48a915(0x1a4))/0x9)+parseInt(_0x48a915(0x1b3))/0xa*(parseInt(_0x48a915(0x1aa))/0xb)+parseInt(_0x48a915(0x1ca))/0xc;if(_0x110ab7===_0x23c462)break;else _0x4ca1d3['push'](_0x4ca1d3['shift']());}catch(_0x327236){_0x4ca1d3['push'](_0x4ca1d3['shift']());}}}(a0_0x20a8,0x4e0e4));let downloading_current=0x0,downloading_total=0x0,image_blobs;function sleep(_0x2617f5){return new Promise(_0x2326ba=>setTimeout(_0x2326ba,_0x2617f5));}const gmXmlHttpRequest=_0x1d8099=>{return new Promise((_0x55bce4,_0x3640fe)=>{GM_xmlhttpRequest({..._0x1d8099,'onload':_0x55bce4,'onerror':_0x3640fe});});},download_not_encrypted=async(_0x42a294,_0x12d394)=>{const _0x1c85fc=a0_0x2e79;try{const _0x7fb2ca=await gmXmlHttpRequest({'method':_0x1c85fc(0x1a2),'url':_0x42a294,'headers':{'User-Agent':_0x1c85fc(0x1b9),'Referer':location['origin']},'responseType':_0x1c85fc(0x171)}),_0x15279e=_0x7fb2ca[_0x1c85fc(0x16a)],_0x36b50b=new DataView(_0x15279e),_0x5b1a54=_0x36b50b[_0x1c85fc(0x1a8)](0x0,![])['toString'](0x10);let _0x252278=_0x1c85fc(0x1c9),_0x218bfd=_0x1c85fc(0x199);if(_0x5b1a54===_0x1c85fc(0x181))_0x252278='.webp',_0x218bfd='image/webp';else _0x5b1a54===_0x1c85fc(0x19a)?(_0x252278=_0x1c85fc(0x1a7),_0x218bfd='image/png'):(_0x252278=_0x1c85fc(0x189),_0x218bfd=_0x1c85fc(0x1bd));let _0xde9f2a=(''+(_0x12d394+0x1))[_0x1c85fc(0x194)](0x3,'0')+_0x252278;const _0x47d192=new Blob([_0x15279e],{'type':_0x218bfd});image_blobs[_0x1c85fc(0x1a1)]({'name':_0xde9f2a,'blob':_0x47d192}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}catch(_0x4e53df){console[_0x1c85fc(0x198)]('Failed\x20to\x20download\x20file:',_0x4e53df);}};function update_status(){const _0x468865=a0_0x2e79;document[_0x468865(0x167)](_0x468865(0x17e))['style'][_0x468865(0x1ab)]='flex',document[_0x468865(0x167)](_0x468865(0x17e))[_0x468865(0x1ac)][_0x468865(0x179)]=_0x468865(0x184),document[_0x468865(0x167)]('.status-num')[_0x468865(0x19d)]=downloading_current+_0x468865(0x1b7)+downloading_total;}function create_status_box(){const _0xe0f291=a0_0x2e79;let _0x48d0c4=document[_0xe0f291(0x197)](_0xe0f291(0x172));return _0x48d0c4[_0xe0f291(0x1bf)]='status-num',_0x48d0c4[_0xe0f291(0x1ad)]=downloading_current+'\x20/\x20'+downloading_total,_0x48d0c4;}function create_download_icon(){const _0x10c8e2=a0_0x2e79;let _0x517932=document[_0x10c8e2(0x197)](_0x10c8e2(0x172)),_0x1c9225=document['createElement'](_0x10c8e2(0x1cb));_0x1c9225['className']=_0x10c8e2(0x1a5),_0x1c9225[_0x10c8e2(0x17c)](_0x10c8e2(0x19f),_0x10c8e2(0x173)),_0x1c9225[_0x10c8e2(0x1ac)][_0x10c8e2(0x1bc)]=_0x10c8e2(0x1c0),_0x1c9225[_0x10c8e2(0x1ac)][_0x10c8e2(0x17f)]=_0x10c8e2(0x16b),_0x517932[_0x10c8e2(0x18f)](_0x1c9225);let _0x229a8a=document['createElement'](_0x10c8e2(0x187));_0x229a8a[_0x10c8e2(0x1b0)]='stylesheet',_0x229a8a[_0x10c8e2(0x1b6)]=_0x10c8e2(0x1b5),document[_0x10c8e2(0x185)]('head')[0x0][_0x10c8e2(0x18f)](_0x229a8a);let _0x4510e8=document['createElement'](_0x10c8e2(0x172));_0x4510e8[_0x10c8e2(0x1bf)]='status',_0x4510e8[_0x10c8e2(0x1ac)]['display']=_0x10c8e2(0x175),_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x192)]=_0x10c8e2(0x184),_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x179)]=_0x10c8e2(0x184),_0x4510e8['style']['gap']=_0x10c8e2(0x193),_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x169)]=_0x10c8e2(0x1c6),_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x16c)]=_0x10c8e2(0x18c),_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x1bb)]=_0x10c8e2(0x1c8),_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x16f)]='50vw',_0x4510e8[_0x10c8e2(0x1ac)][_0x10c8e2(0x176)]=_0x10c8e2(0x1c2);let _0x2bbe61=create_status_box();const _0x5195bd=document[_0x10c8e2(0x197)](_0x10c8e2(0x1ac));_0x5195bd[_0x10c8e2(0x1ad)]='\x0a\x09.status-num\x20{\x0a\x09\x09font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x09\x09font-size:\x203rem;\x0a\x09\x09color:\x20#FD7377;\x0a\x09\x09-webkit-text-stroke:\x201px\x20#C62428;\x0a\x09\x09border:\x200.2rem\x20solid\x20#167975;\x0a\x09\x09border-radius:\x201rem;\x0a\x09\x09padding:\x200\x202rem;\x0a\x09\x09background-color:\x20#F9FDFD;\x0a\x09\x09box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x09\x09min-height:\x204rem;\x0a\x09\x09display:\x20none;\x0a\x09}\x0a\x09',document[_0x10c8e2(0x177)][_0x10c8e2(0x18f)](_0x5195bd),_0x4510e8[_0x10c8e2(0x18f)](_0x517932),_0x4510e8[_0x10c8e2(0x18f)](_0x2bbe61);let _0x1eab8c=document[_0x10c8e2(0x167)](_0x10c8e2(0x1b1)),_0x23bd69=_0x1eab8c['firstChild'];return _0x1eab8c['insertBefore'](_0x4510e8,_0x23bd69),_0x4510e8;}function a0_0x20a8(){const _0x4c3a80=['innerHTML','330888ktsLks','src','all','push','GET','blob','135IPRaAV','tai-ve','#heartbeat','.png','getUint32','prototype','56188HbiLJa','display','style','textContent','16LAfJzn','\x0a\x09.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x09\x09transform-origin:\x20center;\x0a\x09}\x0a\x0a\x09@keyframes\x20heartbeat\x20{\x0a\x09\x090%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0925%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x09\x09}\x0a\x09\x0950%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0975%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x09\x09}\x0a\x09\x09100%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09}\x0a\x09','rel','body','load','800JnCMRy','ZipWriter','https://fonts.googleapis.com/css2?family=Acme&display=swap','href','\x20/\x20','status','Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/129.0.0.0\x20Safari/537.36','_url','top','width','image/jpeg','application/zip','className','3rem','close','translate(-50%)','click','URL','url','absolute','send','0.5rem','.bin','3332832fgrXRt','img','querySelector','.zip','position','response','pointer','zIndex','_method','replace','left','splice','arraybuffer','div','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','trim','flex','transform','head','1237392PWhCmN','alignItems','heartbeat','call','setAttribute','length','.status-num','cursor','398870fPEvby','52494646','createObjectURL','mangaRead','center','getElementsByTagName','download','link','14IQqMtX','.jpg','add','data','10000','28YlCNtq','map','appendChild','addEventListener','readyState','justifyContent','1.5rem','padStart','none','17737mjclvK','createElement','error','application/octet-stream','89504e47','revokeObjectURL','72144NrPQJL'];a0_0x20a8=function(){return _0x4c3a80;};return a0_0x20a8();}const throttlePromises=async(_0x303384,_0x2c45eb)=>{const _0x5f43f2=a0_0x2e79;while(_0x303384[_0x5f43f2(0x17d)]>0x0){await Promise[_0x5f43f2(0x1a0)](_0x303384[_0x5f43f2(0x170)](0x0,_0x2c45eb)['map'](_0x7fb6f6=>_0x7fb6f6())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x3889e4=a0_0x2e79;let _0x410712=document[_0x3889e4(0x167)](_0x3889e4(0x1a6));!_0x410712&&(_0x410712=document[_0x3889e4(0x197)](_0x3889e4(0x1ac)),_0x410712[_0x3889e4(0x17c)]('id',_0x3889e4(0x17a)),document[_0x3889e4(0x177)][_0x3889e4(0x18f)](_0x410712)),_0x410712[_0x3889e4(0x1ad)]=_0x3889e4(0x1af);},off_heartbeat_css=()=>{const _0x5bd4cc=a0_0x2e79,_0x408d1a=document[_0x5bd4cc(0x167)](_0x5bd4cc(0x1a6));_0x408d1a[_0x5bd4cc(0x1ad)]='';};function saveBlob(_0x3ca38c,_0xb5af12){const _0x9c0e31=a0_0x2e79,_0x538370=window[_0x9c0e31(0x1c4)][_0x9c0e31(0x182)](_0x3ca38c),_0x25322f=document[_0x9c0e31(0x197)]('a');_0x25322f['href']=_0x538370,_0x25322f[_0x9c0e31(0x186)]=_0xb5af12,_0x25322f[_0x9c0e31(0x1ac)][_0x9c0e31(0x1ab)]=_0x9c0e31(0x195),document[_0x9c0e31(0x1b1)][_0x9c0e31(0x18f)](_0x25322f),_0x25322f[_0x9c0e31(0x1c3)](),_0x25322f['remove'](),window[_0x9c0e31(0x1c4)][_0x9c0e31(0x19b)](_0x538370),image_blobs=null;}const performFurtherActions=async _0x4f6162=>{const _0x40ff0e=a0_0x2e79,_0x1c30d1=JSON['parse'](_0x4f6162)[_0x40ff0e(0x18b)];let _0x58fc0e=_0x1c30d1['chapter_name'];_0x58fc0e=decodeURIComponent(_0x58fc0e)[_0x40ff0e(0x174)]()[_0x40ff0e(0x16e)]('.','');let _0x51be98=_0x1c30d1['scans'];if(_0x51be98[_0x40ff0e(0x17d)]>0x0){downloading_total=_0x51be98[_0x40ff0e(0x17d)];const _0x35cfc5=create_download_icon();_0x35cfc5['addEventListener']('click',async()=>{const _0x5db11e=_0x40ff0e;on_heartbeat_css(),downloading_current=0x0,image_blobs=[];const _0x5b9a4c=_0x51be98[_0x5db11e(0x18e)]((_0x440031,_0x3a0445)=>()=>download_not_encrypted(_0x440031[_0x5db11e(0x1c5)],_0x3a0445));await throttlePromises(_0x5b9a4c,0x2);const _0x56bfbb=new zip['BlobWriter'](_0x5db11e(0x1be)),_0x521a18=new zip[(_0x5db11e(0x1b4))](_0x56bfbb);image_blobs['forEach'](async _0x5a1bad=>{const _0x38a2cb=_0x5db11e;await _0x521a18[_0x38a2cb(0x18a)](_0x5a1bad['name'],new zip['BlobReader'](_0x5a1bad[_0x38a2cb(0x1a3)]));});const _0x1cdff0=await _0x521a18[_0x5db11e(0x1c1)]();saveBlob(_0x1cdff0,_0x58fc0e+_0x5db11e(0x168));});}};function a0_0x2e79(_0x182b0d,_0x21bcc8){const _0x20a82f=a0_0x20a8();return a0_0x2e79=function(_0x2e7902,_0x37be16){_0x2e7902=_0x2e7902-0x167;let _0x274a30=_0x20a82f[_0x2e7902];return _0x274a30;},a0_0x2e79(_0x182b0d,_0x21bcc8);}(function(){'use strict';const _0x1520c1=a0_0x2e79;const _0x5332a7={'mangaRead':null};function _0x187383(){_0x5332a7['mangaRead']&&performFurtherActions(_0x5332a7['mangaRead']);}const _0x18b826=XMLHttpRequest[_0x1520c1(0x1a9)]['open'],_0x5b2c53=XMLHttpRequest[_0x1520c1(0x1a9)][_0x1520c1(0x1c7)];XMLHttpRequest[_0x1520c1(0x1a9)]['open']=function(_0x141b7f,_0x307814,_0x56a9ba,_0x4849cd,_0x4cb5f9){const _0x2340ce=_0x1520c1;this[_0x2340ce(0x16d)]=_0x141b7f,this['_url']=_0x307814,_0x18b826['call'](this,_0x141b7f,_0x307814,_0x56a9ba,_0x4849cd,_0x4cb5f9);},XMLHttpRequest[_0x1520c1(0x1a9)][_0x1520c1(0x1c7)]=function(_0x3f216d){const _0x326f8e=_0x1520c1;this[_0x326f8e(0x190)](_0x326f8e(0x1b2),function(){const _0x3d7bdd=_0x326f8e;this[_0x3d7bdd(0x191)]===0x4&&this[_0x3d7bdd(0x1b8)]===0xc8&&(this[_0x3d7bdd(0x1ba)]['includes']('apis/manga/read')&&(_0x5332a7[_0x3d7bdd(0x183)]=this['responseText'],_0x187383()));}),_0x5b2c53[_0x326f8e(0x17b)](this,_0x3f216d);};}());